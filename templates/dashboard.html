{{define "content"}}
<div hx-get="/dashboard/kpi" hx-trigger="load, every 30s" hx-target="#kpi-cards" hx-swap="innerHTML">
  <div id="kpi-cards" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
    {{template "kpi-cards" .}}
  </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
  <div class="card">
    <h3 class="text-lg font-semibold mb-4">ECO Status</h3>
    <canvas id="eco-chart" height="200"></canvas>
  </div>
  <div class="card">
    <h3 class="text-lg font-semibold mb-4">Recent Activity</h3>
    <div id="activity-feed" hx-get="/dashboard/activity" hx-trigger="load" hx-swap="innerHTML">
      <div class="text-gray-400 text-sm">Loading...</div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  fetch('/api/v1/dashboard/charts').then(r=>r.json()).then(data => {
    if (!data.data) return;
    const d = data.data;
    new Chart(document.getElementById('eco-chart'), {
      type: 'doughnut',
      data: {
        labels: d.eco_labels || ['Draft','Open','Approved','Implemented'],
        datasets: [{data: d.eco_counts || [0,0,0,0], backgroundColor: ['#9CA3AF','#3B82F6','#10B981','#059669']}]
      },
      options: {responsive:true, plugins:{legend:{position:'bottom'}}}
    });
  }).catch(()=>{});
});
</script>
{{end}}
