{{define "layout"}}<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-100">
<script>if(localStorage.getItem('zrp-dark-mode')==='true')document.documentElement.classList.add('dark')</script>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZRP â€” {{.Title}}</title>
<link rel="stylesheet" href="/static/css/style.css">
<script src="https://unpkg.com/htmx.org@2.0.4"></script>
<script src="https://unpkg.com/htmx-ext-response-targets@2.0.2/response-targets.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
</head>
<body class="h-full dark:bg-gray-900 dark:text-gray-100" hx-ext="response-targets">

<div class="flex h-full">
  {{template "sidebar" .}}
  <div id="sidebar-overlay" class="hidden fixed inset-0 bg-black/50 z-39 md:hidden" onclick="document.getElementById('sidebar').classList.remove('open');this.classList.add('hidden')"></div>
  <div class="flex-1 flex flex-col overflow-hidden">
    {{template "header" .}}
    <main id="content" class="flex-1 overflow-y-auto p-3 md:p-6 bg-gray-50 dark:bg-gray-900">
      {{template "content" .}}
    </main>
    <footer class="bg-gray-50 dark:bg-gray-800 border-t dark:border-gray-700 px-4 py-1 text-xs text-gray-400 text-right hidden md:block">ZRP</footer>
  </div>
</div>

{{template "toast" .}}

<div id="modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center">
  <div id="modal-content" class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto">
    <!-- Modal content loads here via HTMX -->
  </div>
</div>

<script>
function toggleDarkMode(){
  const d=document.documentElement.classList.toggle('dark');
  localStorage.setItem('zrp-dark-mode',d);
  document.getElementById('dark-icon-moon').classList.toggle('hidden',d);
  document.getElementById('dark-icon-sun').classList.toggle('hidden',!d);
}
(function(){
  const d=document.documentElement.classList.contains('dark');
  document.getElementById('dark-icon-moon').classList.toggle('hidden',d);
  document.getElementById('dark-icon-sun').classList.toggle('hidden',!d);
})();
function toggleSidebar(){
  const s=document.getElementById('sidebar');
  const o=document.getElementById('sidebar-overlay');
  s.classList.toggle('open');
  o.classList.toggle('hidden');
}
function toggleSidebarGroup(group){
  const h=document.querySelector('[data-group="'+group+'"]');
  const i=document.querySelector('[data-group-items="'+group+'"]');
  if(!h||!i)return;
  h.classList.toggle('collapsed');
  i.classList.toggle('collapsed');
}
</script>
</body>
</html>
{{end}}
