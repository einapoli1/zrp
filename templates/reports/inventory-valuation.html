{{define "inventory-valuation-report"}}
<div class="card">
  <div class="flex justify-between items-center mb-4">
    <div class="flex items-center gap-3">
      <button class="btn btn-secondary" hx-get="/reports" hx-target="#main-content" hx-swap="innerHTML">‚Üê Back</button>
      <h2 class="text-lg font-semibold">Inventory Valuation</h2>
    </div>
    <a href="/api/v1/reports/inventory-valuation?format=csv" target="_blank" class="btn btn-secondary">üì• Export CSV</a>
  </div>

  {{if .ReportData.Groups}}
    {{range .ReportData.Groups}}
    <h3 class="font-semibold mt-4 mb-2">
      {{.Category}} 
      <span class="text-sm text-gray-500">(Subtotal: ${{printf "%.2f" .Subtotal}})</span>
    </h3>
    <div class="overflow-x-auto">
      <table class="w-full text-sm mb-2">
        <thead>
          <tr class="border-b text-left text-gray-500">
            <th class="pb-1">IPN</th>
            <th class="pb-1">Description</th>
            <th class="pb-1 text-right">Qty</th>
            <th class="pb-1 text-right">Unit Price</th>
            <th class="pb-1 text-right">Subtotal</th>
          </tr>
        </thead>
        <tbody>
          {{range .Items}}
          <tr class="border-b border-gray-100">
            <td class="py-1 font-mono">{{.IPN}}</td>
            <td class="py-1">{{.Desc}}</td>
            <td class="py-1 text-right">{{printf "%.0f" .QtyOnHand}}</td>
            <td class="py-1 text-right">${{printf "%.4f" .UnitPrice}}</td>
            <td class="py-1 text-right font-medium">${{printf "%.2f" .Subtotal}}</td>
          </tr>
          {{end}}
        </tbody>
      </table>
    </div>
    {{end}}
    
    <div class="mt-4 pt-4 border-t text-lg font-bold text-right">
      Grand Total: ${{printf "%.2f" .ReportData.GrandTotal}}
    </div>
  {{else}}
    {{template "empty-state" (dict "Message" "No inventory items found" "ActionURL" "" "ActionLabel" "")}}
  {{end}}
</div>
{{end}}