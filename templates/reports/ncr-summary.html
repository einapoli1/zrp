{{define "ncr-summary-report"}}
<div class="card">
  <div class="flex justify-between items-center mb-4">
    <div class="flex items-center gap-3">
      <button class="btn btn-secondary" hx-get="/reports" hx-target="#main-content" hx-swap="innerHTML">‚Üê Back</button>
      <h2 class="text-lg font-semibold">NCR Summary</h2>
    </div>
    <a href="/api/v1/reports/ncr-summary?format=csv" target="_blank" class="btn btn-secondary">üì• Export CSV</a>
  </div>

  <!-- KPI Cards -->
  <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
    <div class="bg-red-50 dark:bg-gray-700 rounded-lg p-4">
      <div class="text-2xl font-bold">{{.ReportData.TotalOpen}}</div>
      <div class="text-sm text-gray-500">Open NCRs</div>
    </div>
    <div class="bg-blue-50 dark:bg-gray-700 rounded-lg p-4">
      <div class="text-2xl font-bold">{{printf "%.1f" .ReportData.AvgResolveDays}}</div>
      <div class="text-sm text-gray-500">Avg Resolve (Days)</div>
    </div>
  </div>

  <!-- By Severity -->
  {{if .ReportData.BySeverity}}
  <h3 class="font-semibold mb-2">By Severity</h3>
  <table class="w-full text-sm mb-4">
    <tbody>
      {{range $severity, $count := .ReportData.BySeverity}}
      <tr class="border-b border-gray-100">
        <td class="py-1">
          {{if eq $severity "critical"}}
            <span class="badge badge-critical">Critical</span>
          {{else if eq $severity "major"}}
            <span class="badge badge-major">Major</span>
          {{else if eq $severity "minor"}}
            <span class="badge badge-minor">Minor</span>
          {{else if eq $severity "low"}}
            <span class="badge badge-low">Low</span>
          {{else}}
            <span class="badge badge-secondary">{{$severity}}</span>
          {{end}}
        </td>
        <td class="py-1 text-right font-medium">{{$count}}</td>
      </tr>
      {{end}}
    </tbody>
  </table>
  {{end}}

  <!-- By Defect Type -->
  {{if .ReportData.ByDefectType}}
  <h3 class="font-semibold mb-2">By Defect Type</h3>
  <table class="w-full text-sm">
    <tbody>
      {{range $defectType, $count := .ReportData.ByDefectType}}
      <tr class="border-b border-gray-100">
        <td class="py-1">{{$defectType}}</td>
        <td class="py-1 text-right font-medium">{{$count}}</td>
      </tr>
      {{end}}
    </tbody>
  </table>
  {{end}}

  {{if and (not .ReportData.BySeverity) (not .ReportData.ByDefectType)}}
  {{template "empty-state" (dict "Message" "No NCR data found" "ActionURL" "" "ActionLabel" "")}}
  {{end}}
</div>
{{end}}