{{define "content"}}
<div class="mb-4 flex flex-col md:flex-row gap-3 items-start md:items-center justify-between">
  <div class="flex gap-2 items-center">
    <input type="text" name="q" class="input w-64" placeholder="Search audit log..."
           hx-get="/audit" hx-trigger="keyup changed delay:300ms" hx-target="#audit-table" hx-swap="innerHTML"
           hx-include="[name='module']" value="{{.Query}}">
    <select name="module" class="input w-40"
            hx-get="/audit" hx-trigger="change" hx-target="#audit-table" hx-swap="innerHTML"
            hx-include="[name='q']">
      <option value="">All Modules</option>
      <option value="eco">ECO</option>
      <option value="inventory">Inventory</option>
      <option value="po">PO</option>
      <option value="workorder">Work Order</option>
      <option value="ncr">NCR</option>
      <option value="device">Device</option>
      <option value="rma">RMA</option>
      <option value="vendor">Vendor</option>
      <option value="quote">Quote</option>
      <option value="user">User</option>
    </select>
  </div>
</div>

<div class="card overflow-x-auto">
  <div id="audit-table">
    {{template "audit-table" .}}
  </div>
</div>
{{end}}

{{define "audit-table"}}
<table class="w-full text-sm">
  <thead>
    <tr class="border-b border-gray-200 dark:border-gray-700 text-left">
      <th class="px-3 py-2 font-medium text-gray-500">Date</th>
      <th class="px-3 py-2 font-medium text-gray-500">User</th>
      <th class="px-3 py-2 font-medium text-gray-500">Action</th>
      <th class="px-3 py-2 font-medium text-gray-500">Module</th>
      <th class="px-3 py-2 font-medium text-gray-500">Record</th>
      <th class="px-3 py-2 font-medium text-gray-500">Summary</th>
    </tr>
  </thead>
  <tbody>
    {{range .AuditEntries}}
    <tr class="border-b border-gray-100 dark:border-gray-700">
      <td class="px-3 py-2 text-gray-500 whitespace-nowrap">{{formatDate .CreatedAt}}</td>
      <td class="px-3 py-2">{{.Username}}</td>
      <td class="px-3 py-2"><span class="badge badge-{{.Action}}">{{.Action}}</span></td>
      <td class="px-3 py-2">{{.Module}}</td>
      <td class="px-3 py-2 font-mono text-blue-600">{{.RecordID}}</td>
      <td class="px-3 py-2 text-gray-600">{{truncate .Summary 60}}</td>
    </tr>
    {{else}}
    <tr><td colspan="6" class="px-3 py-8 text-center text-gray-400">No audit entries found</td></tr>
    {{end}}
  </tbody>
</table>
{{end}}
