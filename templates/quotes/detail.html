{{define "content"}}
<div class="mb-4">
  <a href="/quotes" class="text-blue-600 hover:underline text-sm">&larr; Back to Quotes</a>
</div>

<div class="card mb-6">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-xl font-bold font-mono">{{.Quote.ID}}</h2>
    <div class="flex gap-2">
      {{if eq .Quote.Status "draft"}}
        <span class="badge badge-secondary">Draft</span>
      {{else if eq .Quote.Status "sent"}}
        <span class="badge badge-info">Sent</span>
      {{else if eq .Quote.Status "accepted"}}
        <span class="badge badge-success">Accepted</span>
      {{else if eq .Quote.Status "rejected"}}
        <span class="badge badge-error">Rejected</span>
      {{else}}
        <span class="badge badge-secondary">{{.Quote.Status}}</span>
      {{end}}
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
    <div>
      <label class="label">Customer</label>
      <p class="text-sm text-gray-800 dark:text-gray-200">{{.Quote.Customer}}</p>
    </div>
    <div>
      <label class="label">Valid Until</label>
      <p class="text-sm text-gray-800 dark:text-gray-200">{{if .Quote.ValidUntil}}{{.Quote.ValidUntil}}{{else}}&mdash;{{end}}</p>
    </div>
    <div>
      <label class="label">Created</label>
      <p class="text-sm text-gray-800 dark:text-gray-200">{{if .Quote.CreatedAt}}{{slice .Quote.CreatedAt 0 10}}{{end}}</p>
    </div>
    <div>
      <label class="label">Status</label>
      <p class="text-sm text-gray-800 dark:text-gray-200">{{.Quote.Status}}</p>
    </div>
  </div>

  {{if .Quote.Notes}}
  <div class="mb-4">
    <label class="label">Notes</label>
    <p class="text-sm text-gray-800 dark:text-gray-200">{{.Quote.Notes}}</p>
  </div>
  {{end}}

  <div class="flex gap-2">
    <button class="btn btn-primary" hx-get="/quotes/{{.Quote.ID}}/edit" hx-target="#modal" hx-swap="innerHTML">Edit Quote</button>
    <button class="btn btn-secondary" hx-get="/quotes/{{.Quote.ID}}/margin" hx-target="#margin-panel" hx-swap="innerHTML">üìä Margin Analysis</button>
    <a href="/api/v1/quotes/{{.Quote.ID}}/pdf" target="_blank" class="btn btn-secondary">üñ®Ô∏è Print Quote</a>
  </div>
</div>

<div class="card mb-6">
  <h3 class="text-lg font-semibold mb-4">Line Items</h3>
  {{if .Quote.Lines}}
  <div class="overflow-x-auto">
    <table class="w-full text-sm">
      <thead>
        <tr class="border-b border-gray-200 dark:border-gray-700 text-left">
          <th class="px-3 py-2 font-medium text-gray-500">IPN</th>
          <th class="px-3 py-2 font-medium text-gray-500">Description</th>
          <th class="px-3 py-2 font-medium text-gray-500 text-center">Qty</th>
          <th class="px-3 py-2 font-medium text-gray-500 text-right">Unit Price</th>
          <th class="px-3 py-2 font-medium text-gray-500 text-right">Total</th>
        </tr>
      </thead>
      <tbody>
        {{$total := 0.0}}
        {{range .Quote.Lines}}
        {{$lineTotal := mul .Qty .UnitPrice}}
        {{$total = add $total $lineTotal}}
        <tr class="border-b border-gray-100 dark:border-gray-700">
          <td class="px-3 py-2 font-mono">{{.IPN}}</td>
          <td class="px-3 py-2">{{if .Description}}{{.Description}}{{else}}&mdash;{{end}}</td>
          <td class="px-3 py-2 text-center">{{.Qty}}</td>
          <td class="px-3 py-2 text-right">${{printf "%.2f" .UnitPrice}}</td>
          <td class="px-3 py-2 text-right">${{printf "%.2f" $lineTotal}}</td>
        </tr>
        {{end}}
        <tr class="border-t-2 border-gray-200 dark:border-gray-600 font-bold">
          <td colspan="4" class="px-3 py-2 text-right">Total:</td>
          <td class="px-3 py-2 text-right">${{printf "%.2f" $total}}</td>
        </tr>
      </tbody>
    </table>
  </div>
  {{else}}
  {{template "empty-state" (dict "Message" "No line items" "ActionURL" "" "ActionLabel" "")}}
  {{end}}
</div>

<div id="margin-panel" class="hidden"></div>
{{end}}