{{define "inventory-receive-form"}}
<div class="p-6">
  <h3 class="text-lg font-semibold mb-4">Quick Receive</h3>
  <form hx-post="/inventory/transact" hx-target="#modal-content" hx-swap="innerHTML" class="space-y-4">
    <input type="hidden" name="type" value="receive">
    
    <div style="position:relative">
      <label class="label">IPN</label>
      <input name="ipn" class="input" id="ipn-input" autocomplete="off" required>
      <div id="ipn-dropdown" style="position:absolute;z-index:50;width:100%;background:white;border:1px solid #e5e7eb;border-radius:6px;max-height:200px;overflow-y:auto;display:none;box-shadow:0 4px 12px rgba(0,0,0,0.1)"></div>
    </div>
    
    <div>
      <label class="label">Quantity</label>
      <input name="qty" type="number" step="any" min="0.01" class="input" required>
    </div>
    
    <div>
      <label class="label">Reference (PO#, etc)</label>
      <input name="reference" class="input">
    </div>
    
    <div>
      <label class="label">Notes</label>
      <input name="notes" class="input">
    </div>
    
    <div class="flex gap-2">
      <button type="submit" class="btn btn-primary">Receive Stock</button>
      <button type="button" onclick="document.getElementById('modal').classList.add('hidden')" class="btn btn-secondary">Cancel</button>
    </div>
  </form>
</div>

<script>
(function() {
  let debounce = null;
  const inp = document.getElementById('ipn-input');
  const dd = document.getElementById('ipn-dropdown');
  
  inp?.addEventListener('input', () => {
    clearTimeout(debounce);
    const q = inp.value.trim();
    if (q.length < 2) { 
      dd.style.display = 'none'; 
      return; 
    }
    
    debounce = setTimeout(async () => {
      try {
        const res = await fetch('/parts?q=' + encodeURIComponent(q) + '&limit=10');
        const data = await res.json();
        const parts = data.data || data || [];
        
        if (parts.length === 0) { 
          dd.style.display = 'none'; 
          return; 
        }
        
        dd.innerHTML = parts.map(p => `<div class="px-3 py-2 cursor-pointer hover:bg-blue-50 text-sm" data-ipn="${p.ipn || p.IPN}">
          <span class="font-mono text-blue-600">${p.ipn || p.IPN}</span>
          <span class="text-gray-500 ml-2">${p.fields?.Description || p.fields?.description || ''}</span>
        </div>`).join('');
        
        dd.style.display = 'block';
        
        dd.querySelectorAll('[data-ipn]').forEach(el => {
          el.addEventListener('click', () => { 
            inp.value = el.dataset.ipn; 
            dd.style.display = 'none'; 
          });
        });
      } catch(e) { 
        dd.style.display = 'none'; 
      }
    }, 200);
  });
})();
</script>
{{end}}

{{define "inventory-transact-success"}}
<div class="p-6 text-center space-y-4">
  <div class="text-green-600">
    <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
    </svg>
    <h3 class="text-lg font-semibold">Stock Received!</h3>
  </div>
  <button onclick="document.getElementById('modal').classList.add('hidden'); location.reload()" 
          class="btn btn-primary">Close</button>
</div>
{{end}}