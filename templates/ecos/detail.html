{{define "content"}}
<div class="mb-4">
  <a href="/ecos" class="text-blue-600 hover:underline text-sm">&larr; Back to ECOs</a>
</div>

<div class="card mb-6" id="eco-detail">
  <div class="flex items-center justify-between mb-4">
    <div>
      <h2 class="text-xl font-bold">{{.ECO.Title}}</h2>
      <span class="font-mono text-gray-500 text-sm">{{.ECO.ID}}</span>
    </div>
    <div class="flex gap-2 items-center">
      <span class="badge badge-{{.ECO.Status}}">{{.ECO.Status}}</span>
      <span class="badge badge-{{.ECO.Priority}}">{{.ECO.Priority}}</span>
    </div>
  </div>

  <div class="prose dark:prose-invert max-w-none mb-6">
    <p class="text-gray-700 dark:text-gray-300">{{.ECO.Description}}</p>
  </div>

  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-6">
    <div><span class="label">Created By</span><p>{{.ECO.CreatedBy}}</p></div>
    <div><span class="label">Created</span><p>{{formatDate .ECO.CreatedAt}}</p></div>
    <div><span class="label">Updated</span><p>{{formatDate .ECO.UpdatedAt}}</p></div>
    {{if .ECO.ApprovedBy}}<div><span class="label">Approved By</span><p>{{deref .ECO.ApprovedBy}}</p></div>{{end}}
  </div>

  {{if .ECO.AffectedIPNs}}
  <div class="mb-6">
    <h3 class="label mb-2">Affected Parts</h3>
    <div class="flex flex-wrap gap-2">
      {{range .AffectedIPNs}}
      <a href="/parts/{{.}}" class="badge badge-open font-mono hover:underline">{{.}}</a>
      {{end}}
    </div>
  </div>
  {{end}}

  <div class="flex gap-2">
    {{if or (eq .ECO.Status "draft") (eq .ECO.Status "open") (eq .ECO.Status "review")}}
    <button hx-post="/ecos/{{.ECO.ID}}/approve" hx-target="#eco-detail" hx-swap="outerHTML"
            class="btn btn-success">Approve</button>
    {{end}}
    {{if eq .ECO.Status "approved"}}
    <button hx-post="/ecos/{{.ECO.ID}}/implement" hx-target="#eco-detail" hx-swap="outerHTML"
            class="btn btn-primary">Mark Implemented</button>
    {{end}}
  </div>
</div>
{{end}}
